version: '3.8'

services:
  # Auth Service
  auth-service:
    build: ./Auth-Service
    container_name: auth-service
    ports:
      - "5009:5009"
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - USE_DOCKER=true
      - SECRET_KEY=${SECRET_KEY:-clinique2025}
      - DATABASE_URI=${DATABASE_URI:-sqlite:///clinique.db}
    networks:
      - clinic-network
    volumes:
      - ./Auth-Service:/app
    restart: unless-stopped

  # Patient Service - Backend
  patient-backend:
    build: ./Patient-Service/backend
    container_name: patient-backend
    ports:
      - "5001:5001"
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - USE_DOCKER=true
      - AUTH_SERVICE_URL=http://auth-service:5009
      - DOCTORS_SERVICE_URL=http://doctors-service:5000
      - RDV_SERVICE_URL=http://rdv-backend:5005
      - SECRET_KEY=${SECRET_KEY:-clinique2025}
      - DATABASE_URI=${DATABASE_URI:-sqlite:///clinique.db}
    networks:
      - clinic-network
    depends_on:
      - auth-service
    volumes:
      - ./Patient-Service/backend:/app
      - patient-uploads:/app/static/uploads
    restart: unless-stopped

  # Patient Service - Frontend
  patient-frontend:
    build: ./Patient-Service/frontend
    container_name: patient-frontend
    ports:
      - "3001:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:5001/api
      - REACT_APP_AUTH_URL=http://localhost:5009
      - NODE_ENV=development
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    networks:
      - clinic-network
    depends_on:
      - patient-backend
    volumes:
      - ./Patient-Service/frontend:/app
      - /app/node_modules
    stdin_open: true
    tty: true
    restart: unless-stopped

  # RDV Service - Backend
  rdv-backend:
    build: ./RDV-Service/backend
    container_name: rdv-backend
    ports:
      - "5005:5005"
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - USE_DOCKER=true
      - AUTH_SERVICE_URL=http://auth-service:5009
      - PATIENTS_SERVICE_URL=http://patient-backend:5001
      - DOCTORS_SERVICE_URL=http://doctors-service:5000
      - SECRET_KEY=${SECRET_KEY:-clinique2025}
      - DATABASE_URI=${DATABASE_URI:-sqlite:///clinique.db}
    networks:
      - clinic-network
    depends_on:
      - auth-service
      - patient-backend
    volumes:
      - ./RDV-Service/backend:/app
    restart: unless-stopped

  # RDV Service - Frontend
  rdv-frontend:
    build: ./RDV-Service/frontend
    container_name: rdv-frontend
    ports:
      - "3002:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:5005/api
      - REACT_APP_AUTH_URL=http://localhost:5009
      - NODE_ENV=development
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    networks:
      - clinic-network
    depends_on:
      - rdv-backend
    volumes:
      - ./RDV-Service/frontend:/app
      - /app/node_modules
    stdin_open: true
    tty: true
    restart: unless-stopped

  # Doctors Service - Backend
  doctors-service:
    build: ./Doctors-Service/backend
    container_name: doctors-service
    ports:
      - "5000:5000"
    environment:
      - FLASK_APP=app.py
      - FLASK_ENV=development
      - USE_DOCKER=true
      - AUTH_SERVICE_URL=http://auth-service:5009
      - SECRET_KEY=${SECRET_KEY:-clinique2025}
      - DATABASE_URI=${DATABASE_URI:-sqlite:///clinique.db}
    networks:
      - clinic-network
    depends_on:
      - auth-service
    volumes:
      - ./Doctors-Service/backend:/app
    restart: unless-stopped

  # Doctors Service - Frontend
  doctors-frontend:
    build: ./Doctors-Service/frontend
    container_name: doctors-frontend
    ports:
      - "3003:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:5000/api
      - REACT_APP_AUTH_URL=http://localhost:5009
      - NODE_ENV=development
      - WATCHPACK_POLLING=true
      - CHOKIDAR_USEPOLLING=true
    networks:
      - clinic-network
    depends_on:
      - doctors-service
    volumes:
      - ./Doctors-Service/frontend:/app
      - /app/node_modules
    stdin_open: true
    tty: true
    restart: unless-stopped

networks:
  clinic-network:
    driver: bridge
    name: clinic-network

volumes:
  patient-uploads: